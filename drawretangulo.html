<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MiauAPI – Rectangle System</title>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    html, body {
      width: 100%; 
      height: 100%; 
      overflow: hidden;
      background: transparent;
      font-family: 'Inter', sans-serif;
    }
    
    body { 
      width: 1920px; 
      height: 1080px; 
      position: relative;
    }

    /* ==========================================
       MÓDULO: RECTANGLE - Sistema de Retângulos
       ========================================== */
    .rectangle {
      position: absolute;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* Animações suaves */
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: scale(0.95); 
      }
      to { 
        opacity: 1; 
        transform: scale(1); 
      }
    }
    
    @keyframes fadeOut {
      from { 
        opacity: 1; 
        transform: scale(1); 
      }
      to { 
        opacity: 0; 
        transform: scale(0.95); 
      }
    }
    
    .rectangle-enter { 
      animation: fadeIn 0.3s ease-out forwards; 
    }
    
    .rectangle-exit { 
      animation: fadeOut 0.3s ease-in forwards; 
    }

    /* Efeito hover para retângulos (opcional) */
    .rectangle:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
  <script>
    console.log('[MiauAPI] Rectangle System iniciando...');

    // Armazena todos os retângulos criados
    const rectangles = {};
    let nextId = 1;

    /**
     * Cria um retângulo na tela
     * @param {number} x - Posição X (0-1920)
     * @param {number} y - Posição Y (0-1080)
     * @param {number} w - Largura em pixels
     * @param {number} h - Altura em pixels
     * @param {number} r - Vermelho (0-255)
     * @param {number} g - Verde (0-255)
     * @param {number} b - Azul (0-255)
     * @param {number} a - Opacidade (0-255)
     * @returns {number} ID do retângulo criado
     */
    function createRectangle(x, y, w, h, r, g, b, a) {
      const id = nextId++;
      
      // Valores padrão (conforme especificado)
      const posX = x ?? 530;
      const posY = y ?? 210;
      const width = w ?? 860;
      const height = h ?? 660;
      const red = r ?? 41;
      const green = g ?? 128;
      const blue = b ?? 185;
      const alpha = a ?? 200;

      // Cria o elemento DOM
      const rect = document.createElement('div');
      rect.className = 'rectangle rectangle-enter';
      rect.id = `rect_${id}`;
      rect.style.left = `${posX}px`;
      rect.style.top = `${posY}px`;
      rect.style.width = `${width}px`;
      rect.style.height = `${height}px`;
      rect.style.backgroundColor = `rgba(${red}, ${green}, ${blue}, ${alpha / 255})`;

      // Adiciona ao DOM
      document.body.appendChild(rect);
      rectangles[id] = rect;

      console.log(`[MiauAPI] Retângulo #${id} criado - Pos(${posX},${posY}) Tam(${width}x${height}) Cor(${red},${green},${blue},${alpha})`);
      
      return id;
    }

    /**
     * Atualiza um retângulo existente
     * @param {number} id - ID do retângulo
     * @param {number} x - Nova posição X (opcional)
     * @param {number} y - Nova posição Y (opcional)
     * @param {number} w - Nova largura (opcional)
     * @param {number} h - Nova altura (opcional)
     * @param {number} r - Novo vermelho (opcional)
     * @param {number} g - Novo verde (opcional)
     * @param {number} b - Novo azul (opcional)
     * @param {number} a - Nova opacidade (opcional)
     */
    function updateRectangle(id, x, y, w, h, r, g, b, a) {
      const rect = rectangles[id];
      if (!rect) {
        console.error(`[MiauAPI] Retângulo #${id} não encontrado!`);
        return;
      }

      // Atualiza posição e tamanho
      if (x !== undefined && x !== null) rect.style.left = `${x}px`;
      if (y !== undefined && y !== null) rect.style.top = `${y}px`;
      if (w !== undefined && w !== null) rect.style.width = `${w}px`;
      if (h !== undefined && h !== null) rect.style.height = `${h}px`;

      // Atualiza cor se pelo menos um valor RGB/A foi fornecido
      if (r !== undefined || g !== undefined || b !== undefined || a !== undefined) {
        const currentColor = rect.style.backgroundColor;
        const match = currentColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);
        
        const currentR = match ? parseInt(match[1]) : 41;
        const currentG = match ? parseInt(match[2]) : 128;
        const currentB = match ? parseInt(match[3]) : 185;
        const currentA = match && match[4] ? parseFloat(match[4]) * 255 : 200;

        const newR = r !== undefined && r !== null ? r : currentR;
        const newG = g !== undefined && g !== null ? g : currentG;
        const newB = b !== undefined && b !== null ? b : currentB;
        const newA = a !== undefined && a !== null ? a : currentA;

        rect.style.backgroundColor = `rgba(${newR}, ${newG}, ${newB}, ${newA / 255})`;
      }

      console.log(`[MiauAPI] Retângulo #${id} atualizado`);
    }

    /**
     * Remove um retângulo da tela
     * @param {number} id - ID do retângulo
     */
    function removeRectangle(id) {
      const rect = rectangles[id];
      if (!rect) {
        console.error(`[MiauAPI] Retângulo #${id} não encontrado!`);
        return;
      }

      rect.classList.add('rectangle-exit');
      setTimeout(() => {
        if (rect.parentNode) rect.parentNode.removeChild(rect);
        delete rectangles[id];
        console.log(`[MiauAPI] Retângulo #${id} removido`);
      }, 300);
    }

    /**
     * Remove todos os retângulos da tela
     */
    function clearAll() {
      Object.keys(rectangles).forEach(id => {
        const rect = rectangles[id];
        rect.classList.add('rectangle-exit');
        setTimeout(() => {
          if (rect.parentNode) rect.parentNode.removeChild(rect);
        }, 300);
      });

      setTimeout(() => {
        Object.keys(rectangles).forEach(key => delete rectangles[key]);
        console.log('[MiauAPI] Todos os retângulos removidos');
      }, 300);
    }

    // API Global - Interface principal
    window.MiauAPI = {
      Rectangle: createRectangle,
      UpdateRectangle: updateRectangle,
      RemoveRectangle: removeRectangle,
      ClearAll: clearAll
    };

    // Listener para mensagens do NUI/DUI
    window.addEventListener('message', (event) => {
      const data = event.data;
      
      if (data?.action === 'createRectangle') {
        createRectangle(data.x, data.y, data.w, data.h, data.r, data.g, data.b, data.a);
      } else if (data?.action === 'updateRectangle') {
        updateRectangle(data.id, data.x, data.y, data.w, data.h, data.r, data.g, data.b, data.a);
      } else if (data?.action === 'removeRectangle') {
        removeRectangle(data.id);
      } else if (data?.action === 'clearAll') {
        clearAll();
      }
    });

    console.log('[MiauAPI] Rectangle System pronto! ✓');
  </script>
</body>
</html>
